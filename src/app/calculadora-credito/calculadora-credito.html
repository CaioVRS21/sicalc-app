<div class="flex flex-col items-center justify-center overflow-y-auto min-h-screen bg-[#F4f4f4]">

  <h2 class="text-2xl font-bold mb-6 text-[#005CA9]">Simuladora de Crédito</h2>

  <form 
    #simuladorForm="ngForm" 
    (ngSubmit)="calcular()" 
    class="flex flex-col w-full max-w-sm bg-white p-6 rounded-lg shadow">

    <label class="mb-2 font-medium">Produto de Crédito</label>
    <select name="produto" (ngModelChange)="onProdutoChange()" [(ngModel)]="produtoSelecionadoId" required class="mb-4 p-2 border rounded">
      <option *ngFor="let produto of produtos" [value]="produto.id">{{ produto.nome }}</option>
    </select>

    <label class="mb-2 font-medium">Valor desejado (R$)</label>
    <input name="valor" type="number" #valorModel="ngModel"
      (ngModelChange)="onValorChange()" 
      [(ngModel)]="valorDesejado" 
      [disabled]="!produtoSelecionadoId"
      required min="1" 
      class="mb-4 p-2 border rounded" />

    <label class="mb-2 font-medium">Prazo (meses)</label>
    <input name="prazo" type="number" #prazoModel="ngModel" 
          [(ngModel)]="prazo" 
          required min="1" 
          (ngModelChange)="onPrazoChange()"
           [attr.max]="produtoSelecionado?.prazoMaximoMeses || null"
           class="mb-1 p-2 border rounded"
           [disabled]="!valorModel.valid" />
    <p *ngIf="prazoErroMsg" class="text-sm text-red-600 mb-3">{{ prazoErroMsg }}</p>

    <label class="mb-2 font-medium">Tipo de Amortização</label>
    <select name="tipoCalculo" 
            #tipoModel="ngModel"
            [(ngModel)]="tipoCalculo" 
            required class="mb-4 p-2 border rounded">
    <option value="price">Price (Parcelas Fixas)</option>
    <option value="sac">SAC (Parcelas Decrescentes)</option>
    </select>

    <button type="submit"
            [disabled]="!simuladorForm.form.valid || !isPrazoValido()"
            class="w-full px-4 py-2 bg-[#005CA9] text-white rounded-lg shadow hover:bg-[#00457A] transition">
      Simular
    </button>
  </form>
  <button
        class="px-4 py-4 mt-4 mb-4 bg-[#f39200] text-white rounded-lg shadow hover:bg-[#00457A] transition"
        routerLink="/home">
        Retornar
    </button>

    <div *ngIf="tabelaAmortizacao.length" class="mt-6 bg-gray-50 p-4 rounded-lg shadow-md">
  <h3 class="text-lg font-semibold text-gray-800 mb-4">
    Tabela de Parcelas ({{ tipoCalculo === 'sac' ? 'SAC' : 'Price' }})
  </h3>

  <table class="w-full text-sm border-collapse">
    <thead class="bg-gray-200 text-gray-700">
      <tr>
        <th class="p-2 text-left">Mês</th>
        <th class="p-2 text-right">Parcela</th>
        <th class="p-2 text-right">Juros</th>
        <th class="p-2 text-right">Amortização</th>
        <th class="p-2 text-right">Saldo</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let linha of pagedResults; let i = index" class="border-b">
        <td class="p-2">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
        <td class="p-2 text-right">{{ linha.parcela | currency:'BRL':'symbol':'1.2-2' }}</td>
        <td class="p-2 text-right">{{ linha.juros | currency:'BRL':'symbol':'1.2-2' }}</td>
        <td class="p-2 text-right">{{ linha.amortizacao | currency:'BRL':'symbol':'1.2-2' }}</td>
        <td class="p-2 text-right">{{ linha.saldo | currency:'BRL':'symbol':'1.2-2' }}</td>
      </tr>
    </tbody>
  </table>

  <div class="flex items-center justify-center gap-4 mt-3">
    <button (click)="prevPage()" [disabled]="currentPage === 1"
            class="px-3 py-1 border rounded disabled:opacity-50">‹</button>

    <div class="text-sm text-gray-700">Página {{ currentPage }} / {{ totalPages }}</div>

    <button (click)="nextPage()" [disabled]="currentPage === totalPages"
            class="px-3 py-1 border rounded disabled:opacity-50">›</button>
  </div>
</div>
</div>
